# PEP 484: 类型提示

原 文 &nbsp; [PEP 484 -- Type Hints](https://www.python.org/dev/peps/pep-0484/)

<dl>
    <dt>作 者</dt>
    <dd>
        Guido van Rossum (guido@python.org) <br> 
        Jukka Lehtosalo (jukka.lehtosalo@iki.fi) <br>
        Lukasz Langa (lukasz@python.org)
    </dd>
</dl>

翻 译 &nbsp; Wills Hua (wills.hua96@gmail.com)

状 态 &nbsp; 暂定提案

类 型 &nbsp; 标准类

<dl>
    <dt>发 布 历 史</dt>
    <dd>
        2015年1月16日 <br>
        2015年3月20日 <br>
        2015年4月17日 <br>
        2015年5月20日 <br>
        2015年5月22日 <br>
    </dt>
</dl>

<br>

## 目录

- [摘要](#chapter-1) <div id="content-1">
- [理由与目标](#chapter-2) <div id="content-2">
- [注解的含义](#chapter-3) <div id="content-3">
- [类型定义的语法](#chapter-4) <div id="content-4">
- [与函数注释其他用法的兼容性](#chapter-5) <div id="content-5">
- [类型注释](#chapter-6) <div id="content-6">
- [指定类型](#chapter-7) <div id="content-7">
- [NewType工具函数](#chapter-8) <div id="content-8">
- [存根文件](#chapter-9) <div id="content-9">
- [typing模块](#chapter-10) <div id="content-10">
- [Python 2.7和跨版本代码的建议语法](#chapter-11) <div id="content-11">
- [未被接受的替代方案](#chapter-12) <div id="content-12">
- [PEP开发过程](#chapter-13) <div id="content-13">
- [参考文献](#chapter-14) <div id="content-14">

<br>
<!-- <div class="page"/> -->

## <div id="chapter-1"> [一、摘要](#content-1) 

* [PEP 3107](https://www.python.org/dev/peps/pep-3107/)已经引入了函数注解的语法, 但有意将语义保留为未定义. 目前第三方静态类型分析应用工具已经足够多了, 社区人员采用标准用语和标准库中的基线工具就将获益良多.

* 为了提供标准定义和工具, 本PEP引入了一个临时模块, 且列出一些不适用于注解情形的约定.

* 需要注意的是, 即使注解符合本规范, 本PEP依然明确不会妨碍注解的其他用法, 也不要求(或禁止)对注解的任意特殊处理. 正如[PEP 333](https://www.python.org/dev/peps/pep-0333/)对Web框架的约定, 这只是为了能够更好地合作.

* 例如这个简单函数, 其参数和返回值都在注解中给出了声明:
    ```Python
    def greeting(name: str) -> str:
        return "Hello " + name
    ```

  虽然在运行时通过常规的\_\_annotations\_\_属性可以访问到上述注解, 但运行时并不会进行类型检查. 本提案假定存在一个独立的脱机类型检查程序, 用户可以自愿对源代码运行此检查程序. 这种类型检查程序实质上就是一种非常强大的查错工具. (当然某些用户是可以在运行时采用类似的检查程序实现"契约式设计"或JIT优化, 但这些工具尚未完全成熟.)

* 本提案受到[[mypy]](http://mypy-lang.org/)的强烈启发. 如, "整数序列"类型可以写为Sequence[int]. 方括号表示无需向语言添加新的语法. 上述示例用到了自定义类型Sequence, 是从纯Python模块typing中导入的. 通过实现元类(metaclass)中的\_\_getitem\_\_()方法, Sequence[int]表示法在运行时得以生效(但主要是对脱机类型检查程序有意义).

* 类型系统支持类型组合(Union)、范型类型(Generic type)和特殊类型Any, Any类型可与所有类型相容(即可以赋值给所有类型, 也可以从所有类型赋值). Any类型的特性取自渐进定型的理念. 渐进定型和全类型系统已在[PEP 483](https://www.python.org/dev/peps/pep-0483/)中有所解释.

* 在[PEP 482](https://www.python.org/dev/peps/pep-0482/)中, 还介绍了其他一些已借鉴或可比较的方案.

<br>
<!-- <div class="page"/> -->

## <div id="chapter-2"> [二、理由与目标](#content-2) 

* [PEP 3107](https://www.python.org/dev/peps/pep-3107/)已加入了为函数定义中的各个部分添加注解的支持. 尽管没有为注解定义什么含义, 但已经隐隐有了一个目标, 即把注解用于类型提示[[gvr-artima]](https://www.artima.com/weblogs/viewpost.jsp?thread=85551), 在[PEP 3107](https://www.python.org/dev/peps/pep-3107/)中这被列为第一个可能应用的场景.

* 本PEP旨在为类型注解提供一种标准语法, 让Python代码更加开放、更易于静态分析和重构, 提供一种潜在的运行时类型检查方案, 以及(或许在某些上下文中)能利用类型信息生成代码.

* 在这些目标中, 静态分析是最重要的. 包括了对mypy这类脱机类型检查程序的支持, 以及可供IDE使用的代码自动补全和重构的标准表示法.

<br>
<!-- <div class="page"/> -->

## <div id="chapter-3"> [三、注解的含义](#content-3) 

<br>
<!-- <div class="page"/> -->

## <div id="chapter-4"> [四、类型定义的语法](#content-4) 

<br>
<!-- <div class="page"/> -->

## <div id="chapter-5"> [五、与函数注释其他用法的兼容性](#content-5) 

<br>
<!-- <div class="page"/> -->

## <div id="chapter-6"> [六、类型注释](#content-6) 

<br>
<!-- <div class="page"/> -->

## <div id="chapter-7"> [七、指定类型](#content-7) 

<br>
<!-- <div class="page"/> -->

## <div id="chapter-8"> [八、NewType工具函数](#content-8) 

<br>
<!-- <div class="page"/> -->

## <div id="chapter-9"> [九、存根文件](#content-9) 

<br>
<!-- <div class="page"/> -->

## <div id="chapter-10"> [十、typing模块](#content-10) 

<br>
<!-- <div class="page"/> -->

## <div id="chapter-11"> [十一、Python 2.7和跨版本代码的建议语法](#content-11) 

<br>
<!-- <div class="page"/> -->

## <div id="chapter-12"> [十二、未被接受的替代方案](#content-12) 

<br>
<!-- <div class="page"/> -->

## <div id="chapter-13"> [十三、PEP开发过程](#content-13) 

<br>
<!-- <div class="page"/> -->

## <div id="chapter-14"> [十四、参考文献](#content-14) 
